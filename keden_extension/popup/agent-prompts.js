/**
 * KEDEN PI - –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ –∏ JS-–º–µ—Ä–∂
 * ==========================================
 * –§–∞–π–ª-–∞–≥–µ–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ Keden PI.
 * –ú–µ—Ä–∂ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ JS –±–µ–∑ –≤—ã–∑–æ–≤–∞ Gemini.
 */

// =====================================================
// –ü–†–û–ú–ü–¢ –î–õ–Ø –§–ê–ô–õ-–ê–ì–ï–ù–¢–ê (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)
// =====================================================
const FILE_AGENT_PROMPT = `
–¢—ã ‚Äî –∞–≥–µ–Ω—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫ —Ç–∞–º–æ–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã Keden PI (–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ).
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–æ–∫—É–º–µ–Ω—Ç –∏ –≤–µ—Ä–Ω–∏ –¥–∞–Ω–Ω—ã–µ –°–†–ê–ó–£ –≤ –≥–æ—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ Keden PI.

–í–ê–ñ–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –°–¢–†–ê–ù–ê: –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ 2-–±—É–∫–≤–µ–Ω–Ω—ã–π –∫–æ–¥ ISO (CN, KZ, AF, RU, TR, KG, UZ...).
2. –ë–ò–ù/–ò–ò–ù: –ì—Ä—É–ø–ø–∞ –∏–∑ 12 —Ü–∏—Ñ—Ä. –ï—Å–ª–∏ –≤ –Ω–æ–º–µ—Ä–µ –µ—Å—Ç—å –±—É–∫–≤—ã –∏–ª–∏ –∑–Ω–∞–∫–∏ ‚Äî —ç—Ç–æ –ù–ï –ë–ò–ù.
3. –ù–ï–†–ï–ó–ò–î–ï–ù–¢–´: –î–ª—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç –ø–∏—à–∏ –í–ï–†–•–ù–ò–ú –†–ï–ì–ò–°–¢–†–û–ú –≤ –ø–æ–ª–µ "district" (–Ω–∞–ø—Ä–∏–º–µ—Ä: "KABUL", "SHANGHAI").
4. –ê–î–†–ï–° (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û): 
   - –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –Ω–æ–º–µ—Ä –¥–æ–º–∞).
   - –ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û –ø–∏—Å–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω—ã, —Ñ–∞–∫—Å—ã, email, —Å–∞–π—Ç—ã, –ø–æ—á—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã.
   - –ï—Å–ª–∏ –≤–∏–¥–∏—à—å "+", "tel:", "fax:", "email:", "@", "www." ‚Äî —É–¥–∞–ª—è–π –≤—Å—é —Å—Ç—Ä–æ–∫—É —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
   - –í –ø–æ–ª–µ address –¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ "KABUL, STREET 4" –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ "SHANGHAI".
5. –†–û–õ–ò (–ö–¢–û –ï–°–¢–¨ –ö–¢–û):
   - INVOICE: Seller/Shipper/Exporter = –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (Consignor). Buyer/Consignee/Importer = –ü–æ–ª—É—á–∞—Ç–µ–ª—å (Consignee).
   - CMR: –ì—Ä–∞—Ñ–∞ 1 = –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (Consignor). –ì—Ä–∞—Ñ–∞ 2 = –ü–æ–ª—É—á–∞—Ç–µ–ª—å (Consignee). –ì—Ä–∞—Ñ–∞ 16/17 = –ü–µ—Ä–µ–≤–æ–∑—á–∏–∫ (Carrier).
   - –ï—Å–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ (KZ), —É –Ω–µ–≥–æ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ë–ò–ù (12 —Ü–∏—Ñ—Ä).
6. EXCEL / CSV: –ï—Å–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ 3 –∫–æ–ª–æ–Ω–∫–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤, –æ–±—ã—á–Ω–æ –æ–Ω–∏ –∏–¥—É—Ç –≤ –ø–æ—Ä—è–¥–∫–µ: –ü–µ—Ä–µ–≤–æ–∑—á–∏–∫ | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å | –ü–æ–ª—É—á–∞—Ç–µ–ª—å.
7. –¢–ù–í–≠–î: –°–¢–†–û–ì–û –ø–µ—Ä–≤—ã–µ 6 —Ü–∏—Ñ—Ä. –û–±—Ä–µ–∑–∞–π –ª–∏—à–Ω–µ–µ.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–û–ü–†–ï–î–ï–õ–ò –¢–ò–ü –î–û–ö–£–ú–ï–ù–¢–ê:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

- Invoice / –ò–Ω–≤–æ–π—Å / –°—á—ë—Ç-—Ñ–∞–∫—Ç—É—Ä–∞ / Commercial Invoice ‚Üí type: "INVOICE" (–°–¢–†–û–ì–û –¢–û–õ–¨–ö–û –ò–ó EXCEL! –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ .xlsx, –≤—ã–¥–∞–π –æ—à–∏–±–∫—É)
- CMR / –¢–¢–ù / –¢–æ–≤–∞—Ä–Ω–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è / Waybill ‚Üí type: "TRANSPORT_DOC"
- –†–µ–µ—Å—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ / –¢–æ–≤–∞—Ä–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä ‚Üí type: "REGISTRY"
- –£–ø–∞–∫–æ–≤–æ—á–Ω—ã–π –ª–∏—Å—Ç / Packing List ‚Üí type: "PACKING_LIST"
- –ó–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç / Passport / Travel Document ‚Üí type: "DRIVER_ID"
- –£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏ / ID Card ‚Üí type: "OTHER" (–ù–ï –∏–∑–≤–ª–µ–∫–∞–π –¥–∞–Ω–Ω—ã–µ –≤–æ–¥–∏—Ç–µ–ª—è!)
- –¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –¢–° / –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¢–° ‚Üí type: "VEHICLE_DOC"
- –î–æ–ø—É—â–µ–Ω–∏–µ –¢–° ‚Üí type: "VEHICLE_PERMIT"
- –î–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Üí type: "POWER_OF_ATTORNEY"
- –ò–Ω–æ–µ ‚Üí type: "OTHER"

‚ö†Ô∏è –í–ê–ñ–ù–û: –î–∞–Ω–Ω—ã–µ –≤–æ–¥–∏—Ç–µ–ª—è (driver) –∑–∞–ø–æ–ª–Ω—è–π –¢–û–õ–¨–ö–û –∏–∑ –ó–ê–ì–†–ê–ù–ü–ê–°–ü–û–†–¢–ê!
–£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî –ù–ï —è–≤–ª—è–µ—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–º –≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –ü–ò.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ö–†–ò–¢–ï–†–ò–ò –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –†–û–õ–ï–ô (–°–£–ü–ï–†-–í–ê–ñ–ù–û):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. –ü–û–õ–£–ß–ê–¢–ï–õ–¨ (CONSIGNEE / Êî∂Ë¥ß‰∫∫):
   - CMR: –°–¢–†–û–ì–û –ì–†–ê–§–ê 2.
   - INVOICE / EXCEL: –ò—â–∏ "Buyer", "Consignee", "Ship to", "Importer" –∏–ª–∏ "Êî∂Ë¥ß‰∫∫".
   - –ü–†–ò–û–†–ò–¢–ï–¢: –ï—Å–ª–∏ "Buyer" –∏ "Ship to" —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è, –±–µ—Ä–∏ "Ship to" (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å –≥—Ä—É–∑–∞).
   - –ù–ï –ü–£–¢–ê–ô —Å –±—Ä–æ–∫–µ—Ä–æ–º! –ü–æ–ª—É—á–∞—Ç–µ–ª—å ‚Äî —ç—Ç–æ —Ç–æ—Ç, –∫—Ç–æ –ü–û–ö–£–ü–ê–ï–¢ —Ç–æ–≤–∞—Ä, –∞ –Ω–µ —Ç–æ—Ç, –∫—Ç–æ —à—Ç–∞–º–ø—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ.

2. –û–¢–ü–†–ê–í–ò–¢–ï–õ–¨ (CONSIGNOR / ÂèëË¥ß‰∫∫):
   - CMR: –°–¢–†–û–ì–û –ì–†–ê–§–ê 1.
   - INVOICE / EXCEL: "Seller", "Shipper", "Exporter", "From" –∏–ª–∏ "ÂèëË¥ß‰∫∫".

3. –ü–ï–†–ï–í–û–ó–ß–ò–ö (CARRIER / ÊâøËøê‰∫∫):
   - CMR: –ì—Ä–∞—Ñ—ã 16 –∏–ª–∏ 17. –ò—â–∏ "Carrier", "Transport company" –∏–ª–∏ "ÊâøËøê‰∫∫".
   - –û–±—ã—á–Ω–æ —Ç–∞–º —Å—Ç–æ–∏—Ç –±–æ–ª—å—à–∞—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è –ø–µ—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏.

4. –î–ï–ö–õ–ê–†–ê–ù–¢ / –ü–†–ï–î–°–¢–ê–í–ò–¢–ï–õ–¨ (DECLARANT / BROKER):
   - –ò—â–∏ —à—Ç–∞–º–ø "–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å", "–ë—Ä–æ–∫–µ—Ä", "Broker" –∏–ª–∏ "–°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ ‚Ññ".
   - –ï–°–õ–ò –¢–´ –í–ò–î–ò–®–¨ –ü–ï–ß–ê–¢–¨ –ö–û–ú–ü–ê–ù–ò–ò –í–ù–ò–ó–£ –î–û–ö–£–ú–ï–ù–¢–ê (–Ω–∞–ø—Ä. –≤ CMR box 23), –Ω–æ —ç—Ç–∞ –∫–æ–º–ø–∞–Ω–∏—è –ù–ï —É–∫–∞–∑–∞–Ω–∞ –≤ –≥—Ä–∞—Ñ–µ 2 ‚Äî –∑–Ω–∞—á–∏—Ç —ç—Ç–æ –ë–†–û–ö–ï–† (–î–µ–∫–ª–∞—Ä–∞–Ω—Ç), –∞ –Ω–µ –ü–æ–ª—É—á–∞—Ç–µ–ª—å.
   - –ù–ï –ö–û–ü–ò–†–£–ô –ü–æ–ª—É—á–∞—Ç–µ–ª—è –≤ –ø–æ–ª–µ –î–µ–∫–ª–∞—Ä–∞–Ω—Ç–∞, –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä—è–º–æ–π –ø–µ—á–∞—Ç–∏ –±—Ä–æ–∫–µ—Ä–∞ –æ—Ç —ç—Ç–æ–π –∫–æ–º–ø–∞–Ω–∏–∏.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ß–¢–û –ò–ó–í–õ–ï–ö–ê–¢–¨ –ò–ó –ö–ê–ñ–î–û–ì–û –¢–ò–ü–ê:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìÑ –ò–ù–í–û–ô–° (INVOICE):
- –ù–û–ú–ï–† –ò –î–ê–¢–ê –∏–Ω–≤–æ–π—Å–∞
- –û–¢–ü–†–ê–í–ò–¢–ï–õ–¨ (Seller / Shipper / –ü—Ä–æ–¥–∞–≤–µ—Ü / Exporter)
- –ü–û–õ–£–ß–ê–¢–ï–õ–¨ (Buyer / Consignee / –ü–æ–∫—É–ø–∞—Ç–µ–ª—å / Importer)

- –¢–û–í–ê–†–´ (products): 
  ¬∑ commercialName: –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ï –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ + –ü–ï–†–ï–í–û–î.
  ¬∑ tnvedCode: –ø–µ—Ä–≤—ã–µ 6 —Ü–∏—Ñ—Ä.
  ¬∑ grossWeight: –≤–µ—Å (–∫–≥).
  ¬∑ quantity: –∫–æ–ª-–≤–æ –º–µ—Å—Ç.
  ¬∑ cost: —Å—É–º–º–∞.
  ¬∑ currencyCode: –∫–æ–¥ –≤–∞–ª—é—Ç—ã.

- –ò–¢–û–ì–ò –î–û–ö–£–ú–ï–ù–¢–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –î–õ–Ø –í–°–ï–• –¢–ò–ü–û–í):
  ¬∑ totalWeight: –æ–±—â–∏–π –≤–µ—Å –ë–†–£–¢–¢–û –≤—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–∫–≥). –ù–∞—Ö–æ–¥–∏ —ç—Ç–æ –≤ —Ñ—É—Ç–µ—Ä–µ –∏–ª–∏ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ.
  ¬∑ totalPackages: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç.
  ¬∑ totalCost: –æ–±—â–∞—è —Å—É–º–º–∞ (—Å—É–º–º–∏—Ä—É–π –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, –µ—Å–ª–∏ –Ω–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏).

–°–ò–°–¢–ï–ú–ù–û–ï –¢–†–ï–ë–û–í–ê–ù–ò–ï: –î–∞–Ω–Ω—ã–µ –∏—Ç–æ–≥–æ–≤ –±—É–¥—É—Ç —Å–≤–µ—Ä—è—Ç—å—Å—è –º–µ–∂–¥—É –ò–Ω–≤–æ–π—Å–æ–º –∏ CMR. –ï—Å–ª–∏ —Ç—ã –∏—Ö –Ω–µ —É–∫–∞–∂–µ—à—å, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.


–ß–¢–û –ò–ó–í–õ–ï–ö–ê–¢–¨ –ò–ó –ö–ê–ñ–î–û–ì–û –¢–ò–ü–ê (–≠–ö–°–ü–ï–†–¢–ù–´–ï –ü–†–ê–í–ò–õ–ê):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìÑ INVOICE / EXCEL (INVOICE):
- –ù–û–ú–ï–† –ò –î–ê–¢–ê: –°–∞–º—ã–π –≤–µ—Ä—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞. –í Excel –∏—â–∏ "Invoice No" –∏–ª–∏ "ÂèëÁ•®Âè∑Á†Å".
- –û–ë–©–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨: –ò—â–∏ "Total Amount", "USD", "EUR" –∏–ª–∏ "ÊÄªÈáëÈ¢ù", "‰ª∑Á®éÂêàËÆ°".
- –í–ê–õ–Æ–¢–ê: –ö–æ–¥ (USD, CNY, KZT). –í –∫–∏—Ç–∞–π—Å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö "CNY" –∏–ª–∏ "RMB".
- –£–°–õ–û–í–ò–Ø –ü–û–°–¢–ê–í–ö–ò (Incoterms): –ò—â–∏ FOB, CPT, DAP, FCA. –í –∫–∏—Ç–∞–π—Å–∫–∏—Ö: "Ë¥∏ÊòìÊúØËØ≠". –†—è–¥–æ–º –≤—Å–µ–≥–¥–∞ –≥–æ—Ä–æ–¥.

üöõ CMR / –¢–¢–ù (TRANSPORT_DOC):
- –ù–û–ú–ï–†: –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª.
- –¢–†–ê–ù–°–ü–û–†–¢ (–ì–†–ê–§–ê 18 / 25): –¢—è–≥–∞—á (Truck) –∏ –ü—Ä–∏—Ü–µ–ø (Trailer).
  ¬∑ –ï—Å–ª–∏ –≤ CMR –ø—É—Å—Ç–æ ‚Äî –∏—â–∏ –≤ —à—Ç–∞–º–ø–∞—Ö –∏–ª–∏ Excel: "ËΩ¶Âè∑" (–¢—è–≥–∞—á), "ÊåÇËΩ¶Âè∑" (–ü—Ä–∏—Ü–µ–ø).
  ¬∑ –ü—Ä–∞–≤–∏–ª–æ: –ü–µ—Ä–≤—ã–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã ‚Äî —Ç—è–≥–∞—á, –≤—Ç–æ—Ä—ã–µ ‚Äî –ø—Ä–∏—Ü–µ–ø.
- –ü–û–õ–£–ß–ê–¢–ï–õ–¨ (–ì–†–ê–§–ê 2): –î—É–±–ª–∏—Ä—É–π –æ—Ç—Å—é–¥–∞ –ë–ò–ù –∏ –∞–¥—Ä–µ—Å. –≠—Ç–æ —ç—Ç–∞–ª–æ–Ω.
- –ü–ï–†–ï–í–û–ó–ß–ò–ö (–ì–†–ê–§–ê 16/17): –ü–µ—á–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏. –ö–æ–ø–∏—Ä—É–π –≤ carrier.

üìã –†–ï–ï–°–¢–† –¢–û–í–ê–†–´ / –ü–†–ï–î–°–¢–ê–í–ò–¢–ï–õ–¨ (REGISTRY):
- –¢–û–í–ê–†–´ (–ì–†–ê–§–ê 31, 33, 35, 38): –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤.
  ¬∑ –¢–ù–í–≠–î (6 —Ü–∏—Ñ—Ä): –ü–æ–ª–µ "HS Code" –∏–ª–∏ "Êµ∑ÂÖ≥ÁºñÁ†Å".
  ¬∑ –í–ï–° –ë–†–£–¢–¢–û (Gross): "ÊØõÈáç" –∏–ª–∏ "Gross Weight".
  ¬∑ –í–ï–° –ù–ï–¢–¢–û (Net): "ÂáÄÈáç" –∏–ª–∏ "Net Weight".
  ¬∑ –ö–û–õ–ò–ß–ï–°–¢–í–û –ú–ï–°–¢ (Quantity): "‰ª∂Êï∞" (–º–µ—Å—Ç–∞) –∏–ª–∏ "Êï∞Èáè" (–µ–¥–∏–Ω–∏—Ü—ã).
  ¬∑ –¶–ï–ù–ê (Cost): "Âçï‰ª∑" (–∑–∞ –µ–¥.) –∏–ª–∏ "ÈáëÈ¢ù" (–æ–±—â–∞—è –ø–æ —Å—Ç—Ä–æ–∫–µ).
- –°–í–ò–î–ï–¢–ï–õ–¨–°–¢–í–û –ü–†–ï–î–°–¢–ê–í–ò–¢–ï–õ–Ø / –£–≠–û (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û):
  ¬∑ –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç "—É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã—Ö —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤" (–£–≠–û) –∏–ª–∏ "–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å" ‚Äî –∏–∑–≤–ª–µ–∫–∏ –Ω–æ–º–µ—Ä –°–¢–†–û–ì–û –ø–æ—Å–ª–µ –∑–Ω–∞—á–∫–∞ ‚Ññ.
  ¬∑ –ü–†–ò–ú–ï–†: "‚Ññ KZ/0044/–¢–ò–ü1" -> –Ω–æ–º–µ—Ä "KZ/0044/–¢–ò–ü1".
  ¬∑ –î–ê–¢–ê: –ò—â–∏ –¥–∞—Ç—É –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É ("–≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É —Å", "–¥–∞—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∏—è"). 
  ¬∑ –ü–†–ò–ú–ï–†: "—Å 31.08.2025" -> –¥–∞—Ç–∞ "2025-08-31".
  ¬∑ –ó–∞–ø–∏—à–∏ —ç—Ç–æ –≤: declarant.representativeCertificate: { docNumber: "...", docDate: "–ì–ì–ì–ì-–ú–ú-–î–î", regKindCode: "1/2/3" }.

ü™™ –ü–ê–°–ü–û–†–¢ –í–û–î–ò–¢–ï–õ–Ø (DRIVER_ID):
- driver.iin: –ò–ò–ù (12 —Ü–∏—Ñ—Ä). –í –ø–∞—Å–ø–æ—Ä—Ç–∞—Ö –†–ö ‚Äî –ø–æ–ª–µ "–ñ–°–ù / IIN" –∏–ª–∏ "Personal No." (–Ω–∞–ø—Ä. 790921300248).
- lastName: –§–∞–º–∏–ª–∏—è (Surname). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –õ–ê–¢–ò–ù–ò–¶–£, –ó–ê–ì–õ–ê–í–ù–´–ú–ò (–Ω–∞–ø—Ä. SAITOV).
- firstName: –ò–º—è (Given names). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –õ–ê–¢–ò–ù–ò–¶–£, –ó–ê–ì–õ–ê–í–ù–´–ú–ò (–Ω–∞–ø—Ä. SABITZHAN).
- document.number: –ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞ (Passport No.).

üöó –¢–ï–•–ü–ê–°–ü–û–†–¢ (VEHICLE_DOC):
- tractorRegNumber: –ì–æ—Å. –Ω–æ–º–µ—Ä —Ç—è–≥–∞—á–∞ (–Ω–∞–ø—Ä. 584AEK19). –û–±—ã—á–Ω–æ 3 —Ü–∏—Ñ—Ä—ã –∏ 3 –±—É–∫–≤—ã.
- trailerRegNumber: –ì–æ—Å. –Ω–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞ (–Ω–∞–ø—Ä. 84ADL19). –û–±—ã—á–Ω–æ 2 —Ü–∏—Ñ—Ä—ã –∏ 3 –±—É–∫–≤—ã.
- tractorCountry / trailerCountry: –°—Ç—Ä–∞–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä. KZ).
- –ï–°–õ–ò –ù–ê –§–û–¢–û –î–í–ê –¢–ï–•–ü–ê–°–ü–û–†–¢–ê:
  1. –¢—è–≥–∞—á (Tractor) ‚Äî —ç—Ç–æ –≥—Ä—É–∑–æ–≤–∏–∫ (Volvo, Scania, Mercedes, DAF –∏ —Ç.–¥.).
  2. –ü—Ä–∏—Ü–µ–ø (Trailer) ‚Äî —ç—Ç–æ –ø—Ä–∏—Ü–µ–ø –∏–ª–∏ –ø–æ–ª—É–ø—Ä–∏—Ü–µ–ø (Krone, Schmitz, Koegel –∏ —Ç.–¥.).
  3. –í—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω—è–π –∏ —Ç—è–≥–∞—á, –∏ –ø—Ä–∏—Ü–µ–ø, –µ—Å–ª–∏ –æ–Ω–∏ –æ–±–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞ —Ñ–æ—Ç–æ.

üìú –°–í–ò–î–ï–¢–ï–õ–¨–°–¢–í–û –û –î–û–ü–£–©–ï–ù–ò–ò (OTHER):
- document.type: "OTHER" (–∏–ª–∏ "VEHICLE_DOC" –µ—Å–ª–∏ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –º–∞—à–∏–Ω—É).
- document.number: –ü–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä (–Ω–∞–ø—Ä. 398 55300-080825-00394).
- document.date: –î–∞—Ç–∞ –¥–æ (Valid until), –æ–±—ã—á–Ω–æ –≤ Box 7.
- –†–µ–≥. –Ω–æ–º–µ—Ä –∏ –º–∞—Ä–∫–∞ (Box 1, Box 4): –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç—è–≥–∞—á–∞ –∏–ª–∏ –ø—Ä–∏—Ü–µ–ø–∞.

üìù –î–û–ì–û–í–û–† –≠–ö–°–ü–ï–î–ò–¶–ò–ò / –ü–û–†–£–ß–ï–ù–ò–Ø (CONTRACT):
- document.type: "CONTRACT".
- document.number: –ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞ (–Ω–∞–ø—Ä. 571AFZ19).
- document.date: –î–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞.
- –°–¢–û–†–û–ù–´: –ò—â–∏ "–≠–∫—Å–ø–µ–¥–∏—Ç–æ—Ä" (–æ–±—ã—á–Ω–æ —Ä–µ–∑–∏–¥–µ–Ω—Ç –†–ö) –∏ "–ó–∞–∫–∞–∑—á–∏–∫" (–ü–æ–ª—É—á–∞—Ç–µ–ª—å –∏–ª–∏ –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å).
- –¢–†–ê–ù–°–ü–û–†–¢ –ò –í–û–î–ò–¢–ï–õ–¨: –ß–∞—Å—Ç–æ —É–∫–∞–∑–∞–Ω—ã –≤ —Ç–µ–∫—Å—Ç–µ –¥–æ–≥–æ–≤–æ—Ä–∞ (–Ω–∞–ø—Ä. –ì–æ—Å.–Ω–æ–º–µ—Ä ATC, –§–ò–û –≤–æ–¥–∏—Ç–µ–ª—è). –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CMR.

üè¢ –°–í–ò–î–ï–¢–ï–õ–¨–°–¢–í–û –£–≠–û (OTHER):
- document.type: "OTHER".
- document.number: –ù–æ–º–µ—Ä —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ (–Ω–∞–ø—Ä. KZ/0044/–¢–ò–ü1).
- document.date: –î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É.
- regKindCode: –¢–∏–ø –£–≠–û. –ï—Å–ª–∏ –≤ –Ω–æ–º–µ—Ä–µ –∏–ª–∏ —Ç–µ–∫—Å—Ç–µ —É–∫–∞–∑–∞–Ω–æ "–¢–ò–ü 1" ‚Äî –∫–æ–¥ "1", "–¢–ò–ü 2" ‚Äî –∫–æ–¥ "2", "–¢–ò–ü 3" ‚Äî –∫–æ–¥ "3".
- –ö–û–ú–ü–ê–ù–ò–Ø: –ò–º—è –∏ –ë–ò–ù –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä. –¢–û–û "EKAY LTD"). –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –î–µ–∫–ª–∞—Ä–∞–Ω—Ç–∞ (declarant).

üìú –î–û–í–ï–†–ï–ù–ù–û–°–¢–¨ (POWER_OF_ATTORNEY / CONTRACT):
- document.type: "POWER_OF_ATTORNEY".
- document.number: –ù–æ–º–µ—Ä –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä. ‚Ññ 01 –∏–ª–∏ ‚Ññ 123/24).
- document.date: –î–∞—Ç–∞ –≤—ã–¥–∞—á–∏.
- VALIDITY: –ò—â–∏ "—Å—Ä–æ–∫–æ–º –¥–æ" –∏–ª–∏ "–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –¥–æ". –ó–∞–ø–∏—à–∏ –≤ startDate –∏ endDate.
- –ü–û–î–ü–ò–°–ê–ù–¢ (filler): –ò–º—è —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä–æ–º—É –≤—ã–¥–∞–Ω–∞ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.
  ¬∑ –ò–∑–≤–ª–µ–∫–∞–π: –ò–ò–ù (12 —Ü–∏—Ñ—Ä), –§–∞–º–∏–ª–∏—é, –ò–º—è, –û—Ç—á–µ—Å—Ç–≤–æ.
  ¬∑ –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ "–õ–∏—Ü–æ, –∑–∞–ø–æ–ª–Ω–∏–≤—à–µ–µ —Ç–∞–º–æ–∂–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç".

üìë –û–ü–ò–°–¨ –î–û–ö–£–ú–ï–ù–¢–û–í (OTHER):
- document.type: "OTHER".
- document.number: –ù–æ–º–µ—Ä –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É (–Ω–∞–ø—Ä. 9026992).
- –¢–†–ê–ù–°–ü–û–†–¢: –í–≤–µ—Ä—Ö—É –ª–∏—Å—Ç–∞ (–Ω–∞–ø—Ä. 584AEK19/84ADL19).
- –ò–¢–û–ì–û: –í–µ—Å –±—Ä—É—Ç—Ç–æ, –°—Ç–æ–∏–º–æ—Å—Ç—å, –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è —Å–≤–µ—Ä–∫–∏ —Å –∏–Ω–≤–æ–π—Å–æ–º –∏ CMR.
- –¢–ê–ë–õ–ò–¶–ê –î–û–ö–£–ú–ï–ù–¢–û–í: –ò–∑–≤–ª–µ–∫–∞–π —Ç–∏–ø—ã (CMR, –ò–Ω–≤–æ–π—Å, –†–µ–µ—Å—Ç—Ä, –î–æ–≥–æ–≤–æ—Ä), –∏—Ö –Ω–æ–º–µ—Ä–∞ –∏ –¥–∞—Ç—ã. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è CMR –æ–±—ã—á–Ω–æ –∏–º–µ–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å–µ—Ç–∫—É –≥—Ä–∞—Ñ:

1. –û–¢–ü–†–ê–í–ò–¢–ï–õ–¨ (Box 1): –í–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª.
2. –ü–û–õ–£–ß–ê–¢–ï–õ–¨ (Box 2): –ü–æ–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º. 
3. –ü–ï–†–ï–í–û–ó–ß–ò–ö (Box 16/23): –ò–º—è –∫–æ–º–ø–∞–Ω–∏–∏ –∏ —á–∞—Å—Ç–æ —Å–∏–Ω–∏–π —à—Ç–∞–º–ø. –ï—Å–ª–∏ –≤ —à—Ç–∞–º–ø–µ –µ—Å—Ç—å –ë–ò–ù/–ò–ò–ù (12 —Ü–∏—Ñ—Ä) ‚Äî —ç—Ç–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
4. –¢–†–ê–ù–°–ü–û–†–¢ (Box 25): –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ —Ç—è–≥–∞—á–∞ –∏ –ø—Ä–∏—Ü–µ–ø–∞. –ò—â–∏ –≤ –ì–†–ê–§–ï 25 –ò–õ–ò –í –°–ò–ù–ò–• –®–¢–ê–ú–ü–ê–• (Box 23/25). –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –¥–µ—Ñ–∏—Å –∏–ª–∏ —Å–ª—ç—à (–Ω–∞–ø—Ä. "584AEK19-84ADL19"), —Ç–æ –ø–µ—Ä–≤–æ–µ ‚Äî —Ç—è–≥–∞—á, –≤—Ç–æ—Ä–æ–µ ‚Äî –ø—Ä–∏—Ü–µ–ø.
5. –ò–ù–í–û–ô–° (Box 5): –ü–æ–ª–µ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä. XYHYWB1707).
6. –í–ï–° (Box 11): –í–µ—Å –±—Ä—É—Ç—Ç–æ (Gross weight).
7. –ú–ï–°–¢–ê (Box 6/7): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç.
8. –ù–û–ú–ï–† –¢–¢–ù/CMR: –ò—â–∏ –ü–ï–ß–ê–¢–ù–´–ô –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞. –û–±—ã—á–Ω–æ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∏–ª–∏ –≤ –ø–æ–ª–µ "–ù–æ–º–µ—Ä".
9. –î–ê–¢–ê –¢–¢–ù/CMR: –ò—â–∏ –¥–∞—Ç—É —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è. –û–±—ã—á–Ω–æ –≤–Ω–∏–∑—É (Box 15 "–°–æ—Å—Ç–∞–≤–ª–µ–Ω–∞" –∏–ª–∏ Box 21).

‚õî –ò–ì–ù–û–†–ò–†–£–ô –†–£–ö–û–ü–ò–°–ù–´–ô –¢–ï–ö–°–¢: –ò–≥–Ω–æ—Ä–∏—Ä—É–π –ª—é–±—ã–µ –ø–æ–º–µ—Ç–∫–∏, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ —Ä—É—á–∫–æ–π –∏–ª–∏ –ø—Ä–æ–ø–∏—Å—å—é (–∫—Ä–æ–º–µ –Ω–æ–º–µ—Ä–æ–≤ –º–∞—à–∏–Ω –≤ —à—Ç–∞–º–ø–∞—Ö, –µ—Å–ª–∏ –æ–Ω–∏ —á–µ—Ç–∫–∏–µ). –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—Å–µ–≥–¥–∞ —É –ø–µ—á–∞—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –î–ê–ù–ù–´–•:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –î–ê–¢–´: –ì–ì–ì–ì-–ú–ú-–î–î (–Ω–∞–ø—Ä. 2026-02-16).
- –ß–ò–°–õ–ê: –¢–æ—á–∫–∞ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (–Ω–∞–ø—Ä. 1500.50). –£–±–∏—Ä–∞–π "–∫–≥", "—à—Ç", "$".
- –ê–î–†–ï–°–ê: –£–±–∏—Ä–∞–π –∏–Ω–¥–µ–∫—Å—ã, —Ç–µ–ª–µ—Ñ–æ–Ω—ã. –û—Å—Ç–∞–≤–ª—è–π: "–°–¢–†–ê–ù–ê, –ì–û–†–û–î, –£–õ–ò–¶–ê".
- –ì–û–†–û–î: –í –ø–æ–ª–µ "district" –ø–∏—à–∏ —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞/–ø—É–Ω–∫—Ç–∞ –í–ï–†–•–ù–ò–ú –†–ï–ì–ò–°–¢–†–û–ú.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ü–†–ê–í–ò–õ–ê –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

| –ü–æ–ª–µ       | –ü—Ä–∞–≤–∏–ª–æ                                    | –ü—Ä–∏–º–µ—Ä                    |
|------------|--------------------------------------------|-----------------------------|
| –î–∞—Ç—ã       | –°—Ç—Ä–æ–≥–æ –ì–ì–ì–ì-–ú–ú-–î–î                        | "2025-02-10"               |
| –ë–ò–ù        | –†–æ–≤–Ω–æ 12 —Ü–∏—Ñ—Ä                              | "120340001234"             |
| –ò–ò–ù        | –†–æ–≤–Ω–æ 12 —Ü–∏—Ñ—Ä, –ø–µ—Ä–≤—ã–µ 6 = –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è   | "850415350789"             |
| –ù–∞–∑–≤–∞–Ω–∏—è   | –ó–ê–ì–õ–ê–í–ù–´–ú–ò –±—É–∫–≤–∞–º–∏                         | "–¢–û–û –ê–õ–ú–ê –¢–†–ï–ô–î"           |
| –ö–æ–¥—ã —Å—Ç—Ä–∞–Ω | ISO 3166-1 alpha-2                         | KZ, CN, AF, RU, TR, US     |
| –ê–¥—Ä–µ—Å–∞     | –§–∏–∑–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å. –ì–æ—Ä–æ–¥ –≤ "district"      | "KABUL", "ALMATY"          |
| –¢–ù–í–≠–î     | –°—Ç—Ä–æ–≥–æ –ü–ï–†–í–´–ï 6 —Ü–∏—Ñ—Ä                       | "848180"                    |
| –í–µ—Å–∞       | –í –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö, —á–∏—Å–ª–æ                        | 1250.5                      |
| –°—Ç–æ–∏–º–æ—Å—Ç—å  | –ß–∏—Å–ª–æ –±–µ–∑ –∑–Ω–∞–∫–∞ –≤–∞–ª—é—Ç—ã                     | 15420.00                    |
| –ü—É—Å—Ç—ã–µ     | –°—Ç—Ä–æ–∫–∞ "" –∏–ª–∏ —á–∏—Å–ª–æ 0 –∏–ª–∏ false            |                             |

‚õî –¢–û–í–ê–†–´: –ï—Å–ª–∏ –≤–∏–¥–∏—à—å —Å—Ç—Ä–æ–∫—É, –≥–¥–µ —Å—Ç–æ–∏—Ç ¬´–ò–¢–û–ì–û¬ª, ¬´TOTAL¬ª, ¬´–°—É–º–º–∞¬ª, ¬´Amount¬ª –≤ –∫–æ–Ω—Ü–µ —Å–ø–∏—Å–∫–∞ ‚Äî –ü–†–û–ü–£–°–¢–ò –ï–Å. –≠—Ç–æ –Ω–µ —Ç–æ–≤–∞—Ä, —ç—Ç–æ —Å—É–º–º–∞ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤.
   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ products –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–æ–∫ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ –∏–Ω–≤–æ–π—Å–µ.

‚õî –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ –≤ –ø–æ–ª–µ "–∞–¥—Ä–µ—Å" –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω–∞–ø—Ä. +93...), –ù–ï –ü–ò–®–ò –ï–ì–û. –ò—â–∏ —Å—Ç—Ä–æ–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≥–æ—Ä–æ–¥–∞/—É–ª–∏—Ü—ã. –ï—Å–ª–∏ –∞–¥—Ä–µ—Å–∞ –Ω–µ—Ç ‚Äî –æ—Å—Ç–∞–≤—å –ø–æ–ª–µ –ø—É—Å—Ç—ã–º.
   –î–ª—è –Ω–µ—Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–≤ –≥–æ—Ä–æ–¥ –ø–∏—à–∏ –í–ï–†–•–ù–ò–ú –†–ï–ì–ò–°–¢–†–û–ú –≤ –ø–æ–ª–µ "district".

‚õî –ê–î–†–ï–° ‚Äî —ç—Ç–æ –¢–û–õ–¨–ö–û —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, —Å—Ç—Ä–∞–Ω–∞).
   –ù–ò–ö–û–ì–î–ê –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–π –≤ –∞–¥—Ä–µ—Å: —Ç–µ–ª–µ—Ñ–æ–Ω—ã, —Ñ–∞–∫—Å—ã, email, —Å–∞–π—Ç—ã!

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ö–û–ù–¢–†–ê–ì–ï–ù–¢–´ ‚Äî –ü–†–ê–í–ò–õ–ê entityType:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

LEGAL (—Ä–µ–∑–∏–¥–µ–Ω—Ç KZ):
- –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–µ "legal": { "bin": "12—Ü–∏—Ñ—Ä", "nameRu": "–ù–ê–ó–í–ê–ù–ò–ï" }
- –ù–ï –∑–∞–ø–æ–ª–Ω—è–π "nonResidentLegal"

NON_RESIDENT_LEGAL (–∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è):
- –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–µ "nonResidentLegal": { "nameRu": "–ù–ê–ó–í–ê–ù–ò–ï" }
- –ù–ï –∑–∞–ø–æ–ª–Ω—è–π "legal"
- –í addresses –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ countryCode —Å—Ç—Ä–∞–Ω—ã –∫–æ–º–ø–∞–Ω–∏–∏

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (JSON):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

{
  "document": {
    "type": "INVOICE/TRANSPORT_DOC/REGISTRY/DRIVER_ID/VEHICLE_DOC/PACKING_LIST/OTHER",
    "number": "–Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞",
    "date": "–ì–ì–ì–ì-–ú–ú-–î–î"
  },
  "countries": {
    "departureCountry": "ISO –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä. CN)",
    "destinationCountry": "ISO –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä. AF)"
  },
  "consignor": {
    "present": true,
    "entityType": "NON_RESIDENT_LEGAL",
    "nonResidentLegal": { "nameRu": "–û–¢–ü–†–ê–í–ò–¢–ï–õ–¨ –ó–ê–ì–õ–ê–í–ù–´–ú–ò" },
    "legal": { "bin": "", "nameRu": "" },
    "addresses": [{ "typeCode": "01", "countryCode": "ISO_CODE", "district": "–ì–û–†–û–î_–í–ï–†–•–ù–ò–ú_–†–ï–ì–ò–°–¢–†–û–ú", "fullAddress": "–ü–û–õ–ù–´–ô –ê–î–†–ï–°" }]
  },
  "consignee": {
    "present": true,
    "entityType": "LEGAL",
    "legal": { "bin": "12–¶–ò–ù–§–†", "nameRu": "–ü–û–õ–£–ß–ê–¢–ï–õ–¨" },
    "nonResidentLegal": { "nameRu": "" },
    "addresses": [{ "typeCode": "01", "countryCode": "ISO_CODE", "district": "–ì–û–†–û–î_–í–ï–†–•–ù–ò–ú_–†–ï–ì–ò–°–¢–†–û–ú", "fullAddress": "–ü–û–õ–ù–´–ô –ê–î–†–ï–°" }]
  },
  "carrier": {
    "present": true,
    "entityType": "LEGAL",
    "legal": { "bin": "12–¶–ò–§–†", "nameRu": "" },
    "nonResidentLegal": { "nameRu": "" },
    "addresses": [{ "typeCode": "01", "countryCode": "ISO_CODE", "district": "–ì–û–†–û–î_–í–ï–†–•–ù–ò–ú_–†–ï–ì–ò–°–¢–†–û–ú", "fullAddress": "–ü–û–õ–ù–´–ô –ê–î–†–ï–°" }]
  },
  "declarant": {
    "present": true/false,
    "entityType": "LEGAL",
    "legal": { "bin": "", "nameRu": "", "shortNameRu": "–ö–†–ê–¢–ö–û–ï –ù–ê–ó–í–ê–ù–ò–ï" },
    "addresses": [],
    "representativeCertificate": { "docNumber": "", "docDate": "", "regKindCode": "1/2/3" }
  },
  "vehicles": {
    "tractorRegNumber": "–Ω–æ–º–µ—Ä —Ç—è–≥–∞—á–∞ (–¥–æ —Å–ª–µ—à–∞)",
    "tractorCountry": "—Å—Ç—Ä–∞–Ω–∞ —Ç—è–≥–∞—á–∞",
    "trailerRegNumber": "–Ω–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞ (–ø–æ—Å–ª–µ —Å–ª–µ—à–∞)",
    "trailerCountry": "—Å—Ç—Ä–∞–Ω–∞ –ø—Ä–∏—Ü–µ–ø–∞"
  },
  "products": [
    {
      "tnvedCode": "6 —Ü–∏—Ñ—Ä",
      "commercialName": "–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",
      "grossWeight": 0,
      "quantity": 0,
      "cost": 0,
      "currencyCode": "USD"
    }
  ],
  "registry": { "number": "", "date": "" },
  "driver": {
    "present": true/false,
    "iin": "",
    "firstName": "",
    "lastName": ""
  },
  "filler": {
    "present": true,
    "role": "FILLER_DECLARANT",
    "iin": "12–¶–ò–§–†",
    "firstName": "–ò–ú–Ø",
    "lastName": "–§–ê–ú–ò–õ–ò–Ø",
    "patronymic": "–û–¢–ß–ï–°–¢–í–û",
    "powerOfAttorney": {
      "docNumber": "‚Ññ01",
      "docDate": "2026-02-18",
      "startDate": "2026-02-18",
      "endDate": "2027-02-18",
      "typeCode": "09024"
    }
  }
}

‚õî –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø CMR:
1. –í –ì–†–ê–§–ï 2 (–ü–æ–ª—É—á–∞—Ç–µ–ª—å) —á–∞—Å—Ç–æ —É–∫–∞–∑–∞–Ω –Ω–µ—Ä–µ–∑–∏–¥–µ–Ω—Ç. –ù–æ –µ—Å–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –ï–°–¢–¨ –ø–µ—á–∞—Ç—å –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –∫–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–≤–∞–π –∏–º.
2. –í –ì–†–ê–§–ï 25 (–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç): –µ—Å–ª–∏ –Ω–æ–º–µ—Ä–∞ —É–∫–∞–∑–∞–Ω—ã –ø–∞—Ä–æ–π (–Ω–∞–ø—Ä. "571AFZ19/65AEE19"), —Ä–∞–∑–¥–µ–ª—è–π –∏—Ö –Ω–∞ —Ç—è–≥–∞—á –∏ –ø—Ä–∏—Ü–µ–ø.
3. –í–µ—Å –±—Ä—É—Ç—Ç–æ –∏ –∫–æ–ª-–≤–æ –º–µ—Å—Ç –∏—â–∏ –≤ –≥—Ä–∞—Ñ–∞—Ö 7 –∏ 11.
4. –ù–ï–†–ï–ó–ò–î–ï–ù–¢–´: –≤—Å–µ–≥–¥–∞ –ø–∏—à–∏ –≥–æ—Ä–æ–¥ –ó–ê–ì–õ–ê–í–ù–´–ú–ò –≤ –ø–æ–ª–µ "district".

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–§–ò–ù–ê–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –ó–∞–ø–æ–ª–Ω—è–π –¢–û–õ–¨–ö–û —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –†–ï–ê–õ–¨–ù–û –µ—Å—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
- –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –¥–∞–Ω–Ω—ã–µ! –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º
- –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã = –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –≤ products[]
- –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON
`;


// =====================================================
// JS-–ú–ï–†–ñ: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±–µ–∑ Gemini
// –° –ø–æ–ª–Ω–æ–π –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
// =====================================================

/**
 * –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ñ–∞–π–ª-–∞–≥–µ–Ω—Ç–æ–≤ –≤ –µ–¥–∏–Ω—ã–π –æ–±—ä–µ–∫—Ç Keden PI.
 * 1. –°–æ–±–∏—Ä–∞–µ—Ç –í–°–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –∏–∑ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
 * 2. –°–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Äî –Ω–∞–∑–≤–∞–Ω–∏—è, –ë–ò–ù—ã, –∞–¥—Ä–µ—Å–∞
 * 3. –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç (–±–µ—Ä—ë—Ç —Å–∞–º—ã–π –ø–æ–ª–Ω—ã–π)
 * 4. –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∏ –±–µ—Ä—ë—Ç –ª—É—á—à–∏–π
 * 5. –¢–∞–∫–∂–µ —Å–≤–µ—Ä—è–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –≤–æ–¥–∏—Ç–µ–ª—è, –æ–±—â–∏–π –≤–µ—Å
 *
 * @param {Array} agentResults - –º–∞—Å—Å–∏–≤ JSON-–æ–±—ä–µ–∫—Ç–æ–≤ –æ—Ç —Ñ–∞–π–ª-–∞–≥–µ–Ω—Ç–æ–≤
 * @returns {object} - –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Keden PI
 */
function mergeAgentResultsJS(agentResults) {
    console.log(`üîß JS-–º–µ—Ä–∂: –æ–±—ä–µ–¥–∏–Ω—è–µ–º ${agentResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...`);

    const merged = {
        documents: [],
        validation: { errors: [], warnings: [] },
        mergedData: {
            counteragents: {
                consignor: null,
                consignee: null,
                carrier: null,
                declarant: null,
                filler: _emptyFiller()
            },
            vehicles: { tractorRegNumber: '', tractorCountry: '', trailerRegNumber: '', trailerCountry: '' },
            countries: { departureCountry: '', destinationCountry: '' },
            products: [],
            registry: { number: '', date: '' },
            driver: { present: false, iin: '', firstName: '', lastName: '' }
        }
    };

    // =======================================================
    // –§–ê–ó–ê 1: –°–æ–±—Ä–∞—Ç—å –í–°–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    // =======================================================
    const mentions = {
        consignor: [],  // [{source: "Invoice", data: {...}}, ...]
        consignee: [],
        carrier: [],
        declarant: [],
        vehicles: [],
        driver: [],
        filler: [], // [{source, data: {...}}]
        countries: [],
        productCandidates: [], // {source, docType, priority, products[]}
        docTotals: [] // [{source, type, weight, packages, cost}]
    };

    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤: REGISTRY > EXCEL_INVOICE > –æ—Å—Ç–∞–ª—å–Ω—ã–µ
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤: REGISTRY > EXCEL_INVOICE > –¥—Ä—É–≥–∏–µ
    const productPriority = {
        'REGISTRY': 4,
        'INVOICE_EXCEL': 3,
        'CMR': 2,
        'TTN': 2,
        'TRANSPORT_DOC': 2,
        'PACKING_LIST': 1.5,
        'INVOICE': 1,
        'OTHER': 0
    };
    let bestProductSource = 0;
    let bestProductSourceName = '';

    for (const result of agentResults) {
        if (!result || result.error) continue;

        const docType = result.document?.type || 'OTHER';
        const docName = _docTypeName(docType);
        const fileName = result.filename || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–∞–π–ª';
        const sourceLabel = `${docName} (${fileName})`;

        // --- –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –ò–Ω–≤–æ–π—Å—ã —Ç–æ–ª—å–∫–æ –≤ EXCEL ---
        if (docType === 'INVOICE' && !fileName.toLowerCase().endsWith('.xlsx')) {
            merged.validation.errors.push({
                field: 'document.type',
                message: `‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ò–Ω–≤–æ–π—Å ¬´${fileName}¬ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel (.xlsx). PDF –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤.`,
                severity: 'ERROR'
            });
            // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Å–æ–≤—Å–µ–º, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—à–∏–±–∫—É, –Ω–æ —ç—Ç–æ—Ç –∏–Ω–≤–æ–π—Å –±—É–¥–µ—Ç –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –æ—à–∏–±–æ—á–Ω—ã–π
        }

        // --- –î–æ–∫—É–º–µ–Ω—Ç—ã ---
        if (result.document && result.document.type) {
            merged.documents.push({
                filename: fileName,
                type: docType,
                number: result.document.number || '',
                date: result.document.date || ''
            });
        }

        // --- –°–æ–±–∏—Ä–∞–µ–º –í–°–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ ---
        if (result.consignor && result.consignor.present) {
            mentions.consignor.push({ source: sourceLabel, docType, data: result.consignor });
        }
        if (result.consignee && result.consignee.present) {
            mentions.consignee.push({ source: sourceLabel, docType, data: result.consignee });
        }
        if (result.carrier && result.carrier.present) {
            mentions.carrier.push({ source: sourceLabel, docType, data: result.carrier });
        }
        if (result.declarant && result.declarant.present) {
            mentions.declarant.push({ source: sourceLabel, docType, data: result.declarant });
        }

        // --- –°–æ–±–∏—Ä–∞–µ–º –í–°–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ ---
        if (result.vehicles && (result.vehicles.tractorRegNumber || result.vehicles.trailerRegNumber)) {
            mentions.vehicles.push({ source: sourceLabel, docType, data: result.vehicles });
        }

        // --- –°–æ–±–∏—Ä–∞–µ–º –í–°–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è ---
        if (result.driver && result.driver.present) {
            mentions.driver.push({ source: sourceLabel, docType, data: result.driver });
        }

        // --- –°–æ–±–∏—Ä–∞–µ–º –í–°–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞ (filler) ---
        if (result.filler && result.filler.present) {
            mentions.filler.push({ source: sourceLabel, docType, data: result.filler });
        }

        // --- –û–±—â–∏–π –≤–µ—Å –∏–∑ –õ–Æ–ë–û–ì–û –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–¥–ª—è —Å–≤–µ—Ä–∫–∏) ---
        const tw = parseFloat(result.totalWeight || 0);
        const tp = parseInt(result.totalPackages || 0);
        const tc = parseFloat(result.totalCost || 0);

        if (tw > 0 || tp > 0 || tc > 0) {
            mentions.docTotals.push({
                source: sourceLabel,
                type: docType,
                weight: tw,
                packages: tp,
                cost: tc
            });
        }

        // --- –¢–æ–≤–∞—Ä—ã: —Å–æ–±–∏—Ä–∞–µ–º –í–°–ï –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ ---
        if (result.products && result.products.length > 0) {
            let actualDocType = docType;
            // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û: –ò–Ω–≤–æ–π—Å-—Ç–æ–≤–∞—Ä –∏–∑ Excel –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ
            if (docType === 'INVOICE' && fileName.toLowerCase().endsWith('.xlsx')) {
                actualDocType = 'INVOICE_EXCEL';
            } else if (docType === 'INVOICE') {
                // –ï—Å–ª–∏ —ç—Ç–æ –∏–Ω–≤–æ–π—Å –ù–ï –∏–∑ —ç–∫—Å–µ–ª—è ‚Äî –ø–æ–Ω–∏–∂–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –Ω–æ –ù–ï –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–≤—Å–µ–º.
                // –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥—Ç—è–Ω—É—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ PDF/JPG –∏–Ω–≤–æ–π—Å–æ–≤, –µ—Å–ª–∏ –Ω–µ—Ç Excel.
                actualDocType = 'INVOICE';
            }

            const priority = productPriority[actualDocType] || 0;
            const normalized = _normalizeProducts(result.products);
            if (normalized.length > 0 && priority > 0) {
                mentions.productCandidates.push({
                    source: sourceLabel,
                    docType: actualDocType,
                    priority: priority,
                    products: normalized
                });
            } else {
                console.log(`üì¶ –í—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ ${sourceLabel} –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã –∏–ª–∏ –∏–º–µ—é—Ç –Ω—É–ª–µ–≤–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç`);
            }
        }

        // --- –†–µ–µ—Å—Ç—Ä ---
        if (result.registry && result.registry.number) {
            merged.mergedData.registry = {
                number: result.registry.number,
                date: result.registry.date || ''
            };
        }

        // --- –°—Ç—Ä–∞–Ω—ã ---
        if (result.countries) {
            mentions.countries.push({ source: sourceLabel, data: result.countries });
        }
    }

    // =======================================================
    // –§–ê–ó–ê 1.2: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å—Ç—Ä–∞–Ω—ã
    // =======================================================
    if (mentions.countries.length > 0) {
        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç CMR –¥–ª—è —Å—Ç—Ä–∞–Ω
        const best = mentions.countries.find(m => m.source.includes('CMR')) || mentions.countries[0];
        merged.mergedData.countries.departureCountry = (best.data.departureCountry || '').toUpperCase();
        merged.mergedData.countries.destinationCountry = (best.data.destinationCountry || '').toUpperCase();
    }

    // =======================================================
    // –§–ê–ó–ê 1.5: –í—ã–±—Ä–∞—Ç—å –ª—É—á—à–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
    // =======================================================
    if (mentions.productCandidates.length > 0) {
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–æ—Ç –≤—ã—Å—à–µ–≥–æ –∫ –Ω–∏–∑—à–µ–º—É), –ø—Ä–∏ —Ä–∞–≤–Ω–æ–º ‚Äî –ø–æ –∫–æ–ª-–≤—É —Ç–æ–≤–∞—Ä–æ–≤
        mentions.productCandidates.sort((a, b) => {
            if (b.priority !== a.priority) return b.priority - a.priority;
            return b.products.length - a.products.length; // –±–æ–ª—å—à–µ —Ç–æ–≤–∞—Ä–æ–≤ = –ª—É—á—à–µ
        });

        // –ë–µ—Ä—ë–º –ª—É—á—à–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫
        const best = mentions.productCandidates[0];
        merged.mergedData.products = best.products;
        bestProductSourceName = best.docType;
        console.log(`üì¶ –¢–æ–≤–∞—Ä—ã –≤–∑—è—Ç—ã –∏–∑: ${best.source} (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ${best.priority}, ${best.products.length} –ø–æ–∑–∏—Ü–∏–π)`);

        // –ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —Å —Ç–∞–∫–∏–º –∂–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (–Ω–∞–ø—Ä. 2 –∏–Ω–≤–æ–π—Å–∞), –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö —Ç–æ–≤–∞—Ä—ã
        for (let i = 1; i < mentions.productCandidates.length; i++) {
            const candidate = mentions.productCandidates[i];
            if (candidate.priority === best.priority && candidate.priority > 0) {
                merged.mergedData.products.push(...candidate.products);
                console.log(`üì¶ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑: ${candidate.source} (${candidate.products.length} –ø–æ–∑–∏—Ü–∏–π)`);
            }
        }
    }

    // =======================================================
    // –§–ê–ó–ê 2: –°–≤–µ—Ä–∏—Ç—å –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤
    // =======================================================
    for (const role of ['consignor', 'consignee', 'carrier', 'declarant']) {
        const roleName = _roleNameRu(role);
        const allMentions = mentions[role];

        if (allMentions.length === 0) {
            merged.mergedData.counteragents[role] = _emptyCounteragent();
            continue;
        }

        // –°–≤–µ—Ä—è–µ–º –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –º–µ–∂–¥—É —Å–æ–±–æ–π
        _validateAndMergeCounteragent(merged, role, roleName, allMentions);
    }

    // =======================================================
    // –§–ê–ó–ê 3: –°–≤–µ—Ä–∏—Ç—å –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
    // =======================================================
    _validateAndMergeVehicles(merged, mentions.vehicles);

    // =======================================================
    // –§–ê–ó–ê 4: –°–≤–µ—Ä–∏—Ç—å –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è
    // =======================================================
    _validateAndMergeDriver(merged, mentions.driver);

    // =======================================================
    // –§–ê–ó–ê 4.5: –°–≤–µ—Ä–∏—Ç—å –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞ (filler)
    // =======================================================
    _validateAndMergeFiller(merged, mentions.filler);

    // =======================================================
    // –§–ê–ó–ê 5: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ + –≤–∞–ª–∏–¥–∞—Ü–∏—è
    // =======================================================
    merged.mergedData.products = _deduplicateProducts(merged.mergedData.products);

    // =======================================================
    // –§–ê–ó–ê 5.5: –ì–õ–£–ë–û–ö–ê–Ø –°–í–ï–†–ö–ê –ò–¢–û–ì–û–í (Document Reconciliation)
    // =======================================================
    const itemsWeight = merged.mergedData.products.reduce((s, p) => s + p.grossWeight, 0);
    const itemsPackages = merged.mergedData.products.reduce((s, p) => s + p.quantity, 0);
    const itemsCost = merged.mergedData.products.reduce((s, p) => s + p.cost, 0);

    const invoiceTotals = mentions.docTotals.filter(t => t.type === 'INVOICE' || t.type === 'INVOICE_EXCEL');
    const transportTotals = mentions.docTotals.filter(t => t.type === 'TRANSPORT_DOC');

    const sumInvoices = {
        weight: invoiceTotals.reduce((s, t) => s + t.weight, 0),
        packages: invoiceTotals.reduce((s, t) => s + t.packages, 0),
        cost: invoiceTotals.reduce((s, t) => s + t.cost, 0)
    };

    // 1. –õ–∏–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ vs –ò—Ç–æ–≥–∏ –∏–Ω–≤–æ–π—Å–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫)
    if (sumInvoices.weight > 0 && Math.abs(sumInvoices.weight - itemsWeight) > 1) {
        merged.validation.warnings.push({
            field: 'products.grossWeight',
            message: `‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –°—É–º–º–∞ —Å—Ç—Ä–æ–∫ (${itemsWeight.toFixed(1)} –∫–≥) != –ò—Ç–æ–≥—É –≤ –∏–Ω–≤–æ–π—Å–∞—Ö (${sumInvoices.weight.toFixed(1)} –∫–≥). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Excel –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–∫—Ä—ã—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –∏–ª–∏ –æ—à–∏–±–æ–∫ AI.`,
            severity: 'WARNING'
        });
    }

    // 2. –ò–Ω–≤–æ–π—Å—ã vs –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç (CMR/–¢–¢–ù) - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    for (const transport of transportTotals) {
        if (transport.weight > 0 && Math.abs(transport.weight - sumInvoices.weight) > 2) {
            const diff = Math.abs(transport.weight - sumInvoices.weight);
            merged.validation.warnings.push({
                field: 'products.grossWeight',
                message: `‚ùå –ö–û–ù–§–õ–ò–ö–¢ –í–ï–°–ê: –°—É–º–º–∞ –ò–Ω–≤–æ–π—Å–æ–≤ (${sumInvoices.weight.toFixed(1)} –∫–≥) –ù–ï –°–û–í–ü–ê–î–ê–ï–¢ —Å ${transport.source} (${transport.weight.toFixed(1)} –∫–≥). –†–∞–∑–Ω–∏—Ü–∞: ${diff.toFixed(1)} –∫–≥`,
                severity: 'ERROR'
            });
        }
        if (transport.packages > 0 && transport.packages !== sumInvoices.packages) {
            merged.validation.warnings.push({
                field: 'products.quantity',
                message: `‚ùå –ö–û–ù–§–õ–ò–ö–¢ –ú–ï–°–¢: –°—É–º–º–∞ –ò–Ω–≤–æ–π—Å–æ–≤ (${sumInvoices.packages}) –ù–ï –°–û–í–ü–ê–î–ê–ï–¢ —Å ${transport.source} (${transport.packages})`,
                severity: 'ERROR'
            });
        }
    }

    merged.mergedData.reconciliation = {
        items: { weight: itemsWeight, packages: itemsPackages, cost: itemsCost },
        invoices: sumInvoices,
        transport: transportTotals[0] || null
    };

    // =======================================================
    // –§–ê–ó–ê 6: –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    // =======================================================
    _finalValidation(merged);

    console.log(`‚úÖ JS-–º–µ—Ä–∂ –∑–∞–≤–µ—Ä—à—ë–Ω: ${merged.documents.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, ${merged.mergedData.products.length} —Ç–æ–≤–∞—Ä–æ–≤, ${merged.validation.errors.length} –æ—à–∏–±–æ–∫, ${merged.validation.warnings.length} –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π`);
    if (bestProductSourceName) {
        console.log(`üì¶ –¢–æ–≤–∞—Ä—ã –≤–∑—è—Ç—ã –∏–∑: ${bestProductSourceName}`);
    }

    return merged;
}


// =====================================================
// –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤
// =====================================================

/**
 * –°–≤–µ—Ä—è–µ—Ç –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –ø–æ —Ä–∞–∑–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º.
 * –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—à–∏–±–∫–∞ + –±–µ—Ä—ë—Ç —Å–∞–º—ã–π –ø–æ–ª–Ω—ã–π.
 */
function _validateAndMergeCounteragent(merged, role, roleName, allMentions) {
    // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∏ –ë–ò–ù—ã (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
    const names = [];   // {name, source}
    const bins = [];    // {bin, source}

    for (const m of allMentions) {
        const name = _getCounteragentName(m.data);
        const bin = m.data.legal?.bin || '';

        if (name) names.push({ name: name.toUpperCase().trim(), source: m.source });
        if (bin) bins.push({ bin: bin.trim(), source: m.source });
    }

    // --- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∏–º—ë–Ω ---
    const uniqueNames = [...new Set(names.map(n => n.name))];
    if (uniqueNames.length > 1) {
        // –£–º–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ: –µ—Å–ª–∏ –∏–º–µ–Ω–∞ –ø–æ—Ö–æ–∂–∏ –Ω–∞ 80% (–¥–∏—Å—Ç–∞–Ω—Ü–∏—è –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞), –Ω–µ —Å—á–∏—Ç–∞–µ–º –æ—à–∏–±–∫–æ–π
        let hasRealConflict = false;
        const baseName = uniqueNames[0];
        for (let i = 1; i < uniqueNames.length; i++) {
            const similarity = _calculateSimilarity(baseName, uniqueNames[i]);
            if (similarity < 0.8) {
                hasRealConflict = true;
                break;
            }
        }

        if (hasRealConflict) {
            const details = names.map(n => `¬´${n.name}¬ª –≤ ${n.source}`).join(', ');
            // –ú–µ–Ω—è–µ–º ERROR –Ω–∞ WARNING, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–≤–æ–¥
            merged.validation.warnings.push({
                field: `${role}.name`,
                message: `‚ö†Ô∏è ${roleName} —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö: ${details}`,
                severity: 'WARNING'
            });
        }
    }

    // --- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ë–ò–ù–æ–≤ ---
    const uniqueBins = [...new Set(bins.map(b => b.bin))];
    if (uniqueBins.length > 1) {
        const details = bins.map(b => `${b.bin} –≤ ${b.source}`).join(', ');
        merged.validation.errors.push({
            field: `${role}.bin`,
            message: `‚ö†Ô∏è –ë–ò–ù ${roleName.toLowerCase()} —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è: ${details}`,
            severity: 'ERROR'
        });
    }

    // --- –û–±—ä–µ–¥–∏–Ω—è–µ–º: –±–µ—Ä—ë–º —Å–∞–º—ã–π "–ø–æ–ª–Ω—ã–π" ---
    // –°—á–∏—Ç–∞–µ–º "–ø–æ–ª–Ω–æ—Ç—É" –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
    let best = null;
    let bestScore = -1;

    for (const m of allMentions) {
        const score = _counteragentCompleteness(m.data, role, m.docType);
        if (score > bestScore) {
            bestScore = score;
            best = m.data;
        }
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
    const result = {
        present: true,
        entityType: best.entityType || 'LEGAL',
        legal: best.legal || { bin: '', nameRu: '' },
        nonResidentLegal: best.nonResidentLegal || { nameRu: '' },
        addresses: best.addresses || [],
        representativeCertificate: best.representativeCertificate || undefined
    };

    // –î–æ–ø–æ–ª–Ω—è–µ–º –∏–∑ –¥—Ä—É–≥–∏—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Ç–æ, —á–µ–≥–æ –Ω–µ—Ç –≤ –ª—É—á—à–µ–º
    for (const m of allMentions) {
        if (m.data === best) continue;

        // –î–æ–ø–æ–ª–Ω—è–µ–º –ë–ò–ù
        if (result.entityType === 'LEGAL' && !result.legal.bin && m.data.legal?.bin) {
            result.legal.bin = m.data.legal.bin;
        }
        // –î–æ–ø–æ–ª–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
        if (result.entityType === 'LEGAL' && !result.legal.nameRu && m.data.legal?.nameRu) {
            result.legal.nameRu = m.data.legal.nameRu;
        }
        if (result.entityType === 'NON_RESIDENT_LEGAL' && !result.nonResidentLegal.nameRu && m.data.nonResidentLegal?.nameRu) {
            result.nonResidentLegal.nameRu = m.data.nonResidentLegal.nameRu;
        }
        // –î–æ–ø–æ–ª–Ω—è–µ–º –∞–¥—Ä–µ—Å
        if ((!result.addresses || result.addresses.length === 0) && m.data.addresses?.length > 0) {
            result.addresses = m.data.addresses;
        }
        // –î–æ–ø–æ–ª–Ω—è–µ–º —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ
        if (m.data.representativeCertificate) {
            if (!result.representativeCertificate) result.representativeCertificate = {};
            if (!result.representativeCertificate.docNumber) result.representativeCertificate.docNumber = m.data.representativeCertificate.docNumber;
            if (!result.representativeCertificate.docDate) result.representativeCertificate.docDate = m.data.representativeCertificate.docDate;
            if (!result.representativeCertificate.regKindCode) result.representativeCertificate.regKindCode = m.data.representativeCertificate.regKindCode;
        }
    }

    // –ù–∞–∑–≤–∞–Ω–∏—è ‚Äî –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
    if (result.legal?.nameRu) result.legal.nameRu = result.legal.nameRu.toUpperCase();
    if (result.nonResidentLegal?.nameRu) result.nonResidentLegal.nameRu = result.nonResidentLegal.nameRu.toUpperCase();

    merged.mergedData.counteragents[role] = result;
}


// =====================================================
// –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
// =====================================================

function _validateAndMergeVehicles(merged, vehicleMentions) {
    if (vehicleMentions.length === 0) return;

    // –ü–†–ò–û–†–ò–¢–ï–¢: –¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç (VEHICLE_DOC) > –æ—Å—Ç–∞–ª—å–Ω—ã–µ (CMR –∏ —Ç.–¥.)
    const primaryMentions = vehicleMentions.filter(m => m.docType === 'VEHICLE_DOC');
    const secondaryMentions = vehicleMentions.filter(m => m.docType !== 'VEHICLE_DOC');

    const v = merged.mergedData.vehicles;

    // –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω—è–µ–º –∏–∑ —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç–æ–≤ (–≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö)
    for (const m of primaryMentions) {
        if (!v.tractorRegNumber && m.data.tractorRegNumber) {
            v.tractorRegNumber = m.data.tractorRegNumber.toUpperCase().replace(/\s/g, '');
            v.tractorCountry = (m.data.tractorCountry || v.tractorCountry || '').toUpperCase();
        }
        if (!v.trailerRegNumber && m.data.trailerRegNumber) {
            v.trailerRegNumber = m.data.trailerRegNumber.toUpperCase().replace(/\s/g, '');
            v.trailerCountry = (m.data.trailerCountry || v.trailerCountry || '').toUpperCase();
        }
    }

    // –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –ø—É—Å—Ç—ã–º, –¥–æ–±–∏—Ä–∞–µ–º –∏–∑ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (CMR)
    for (const m of secondaryMentions) {
        if (!v.tractorRegNumber && m.data.tractorRegNumber) {
            v.tractorRegNumber = m.data.tractorRegNumber.toUpperCase().replace(/\s/g, '');
            v.tractorCountry = (m.data.tractorCountry || '').toUpperCase();
        }
        if (!v.trailerRegNumber && m.data.trailerRegNumber) {
            v.trailerRegNumber = m.data.trailerRegNumber.toUpperCase().replace(/\s/g, '');
            v.trailerCountry = (m.data.trailerCountry || '').toUpperCase();
        }
    }

    // –í–ê–õ–ò–î–ê–¶–ò–Ø: –ï—Å–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –Ω–æ–º–µ—Ä–∞ –†–ï–ê–õ–¨–ù–û —Ä–∞–∑–Ω—ã–µ
    const tractors = vehicleMentions.filter(m => m.data.tractorRegNumber).map(m => ({
        num: m.data.tractorRegNumber.toUpperCase().replace(/\s/g, ''),
        src: m.source
    }));
    const uniqueTractors = [...new Set(tractors.map(t => t.num))];

    if (uniqueTractors.length > 1) {
        const details = tractors.map(t => `${t.num} (${t.src})`).join(', ');
        merged.validation.warnings.push({
            field: 'vehicles.tractorRegNumber',
            message: `‚ö†Ô∏è –ù–æ–º–µ—Ä —Ç—è–≥–∞—á–∞ —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è: ${details}. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–æ–º–µ—Ä –∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.`,
            severity: 'WARNING'
        });
    }

    const trailers = vehicleMentions.filter(m => m.data.trailerRegNumber).map(m => ({
        num: m.data.trailerRegNumber.toUpperCase().replace(/\s/g, ''),
        src: m.source
    }));
    const uniqueTrailers = [...new Set(trailers.map(t => t.num))];

    if (uniqueTrailers.length > 1) {
        const details = trailers.map(t => `${t.num} (${t.src})`).join(', ');
        merged.validation.warnings.push({
            field: 'vehicles.trailerRegNumber',
            message: `‚ö†Ô∏è –ù–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞ —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è: ${details}. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–æ–º–µ—Ä –∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.`,
            severity: 'WARNING'
        });
    }
}


// =====================================================
// –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è
// =====================================================

function _validateAndMergeDriver(merged, driverMentions) {
    if (driverMentions.length === 0) return;

    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–æ–¥–∏—Ç–µ–ª–µ
    const iins = [];
    const names = [];

    for (const m of driverMentions) {
        const iin = (m.data.iin || '').trim();
        const fullName = `${(m.data.lastName || '').toUpperCase()} ${(m.data.firstName || '').toUpperCase()}`.trim();

        if (iin) iins.push({ iin, source: m.source });
        if (fullName) names.push({ name: fullName, source: m.source });
    }

    // –°–≤–µ—Ä—è–µ–º –ò–ò–ù—ã
    const uniqueIINs = [...new Set(iins.map(i => i.iin))];
    if (uniqueIINs.length > 1) {
        const details = iins.map(i => `${i.iin} –≤ ${i.source}`).join(', ');
        merged.validation.errors.push({
            field: 'driver.iin',
            message: `‚ö†Ô∏è –ò–ò–ù –≤–æ–¥–∏—Ç–µ–ª—è —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è: ${details}`,
            severity: 'ERROR'
        });
    }

    // –°–≤–µ—Ä—è–µ–º –∏–º–µ–Ω–∞
    const uniqueNames = [...new Set(names.map(n => n.name))];
    if (uniqueNames.length > 1) {
        const details = names.map(n => `¬´${n.name}¬ª –≤ ${n.source}`).join(', ');
        merged.validation.warnings.push({
            field: 'driver.name',
            message: `–§–ò–û –≤–æ–¥–∏—Ç–µ–ª—è —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è: ${details}`,
            severity: 'WARNING'
        });
    }

    // –ü–†–ò–û–†–ò–¢–ï–¢: –ó–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç (DRIVER_ID) > –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
    const passportMentions = driverMentions.filter(m => m.docType === 'DRIVER_ID');
    const otherMentions = driverMentions.filter(m => m.docType !== 'DRIVER_ID');

    // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç ‚Äî –±–µ—Ä—ë–º –¢–û–õ–¨–ö–û –∏–∑ –Ω–µ–≥–æ
    const pool = passportMentions.length > 0 ? passportMentions : otherMentions;

    if (passportMentions.length === 0 && otherMentions.length > 0) {
        merged.validation.warnings.push({
            field: 'driver',
            message: `‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –≤–æ–¥–∏—Ç–µ–ª—è –≤–∑—è—Ç—ã –ù–ï –∏–∑ –∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç–∞ (${otherMentions[0].source}). –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç –≤–æ–¥–∏—Ç–µ–ª—è.`,
            severity: 'WARNING'
        });
    }

    let best = pool[0].data;
    let bestScore = 0;

    for (const m of pool) {
        let score = 0;
        if (m.data.iin) score += 3;
        if (m.data.firstName) score += 1;
        if (m.data.lastName) score += 1;
        if (score > bestScore) {
            bestScore = score;
            best = m.data;
        }
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    merged.mergedData.driver = {
        present: true,
        iin: (best.iin || '').trim(),
        lastName: (best.lastName || '').toUpperCase().trim(),
        firstName: (best.firstName || '').toUpperCase().trim()
    };
}

/**
 * –°–≤–µ—Ä—è–µ—Ç –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞ (filler).
 * –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: POWER_OF_ATTORNEY > –æ—Å—Ç–∞–ª—å–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –§–ò–û –µ—Å—Ç—å –≤ –¥–æ–≥–æ–≤–æ—Ä–µ)
 */
function _validateAndMergeFiller(merged, fillerMentions) {
    if (fillerMentions.length === 0) {
        merged.mergedData.counteragents.filler = _emptyFiller();
        return;
    }

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º: –î–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ
    fillerMentions.sort((a, b) => {
        if (a.docType === 'POWER_OF_ATTORNEY') return -1;
        if (b.docType === 'POWER_OF_ATTORNEY') return 1;
        return 0;
    });

    const bestMention = fillerMentions[0];
    const data = bestMention.data;

    merged.mergedData.counteragents.filler = {
        present: true,
        role: data.role || 'FILLER_DECLARANT',
        iin: (data.iin || '').trim(),
        firstName: (data.firstName || '').toUpperCase().trim(),
        lastName: (data.lastName || '').toUpperCase().trim(),
        patronymic: (data.patronymic || '').toUpperCase().trim(),
        powerOfAttorney: {
            docNumber: (data.powerOfAttorney?.docNumber || '').trim(),
            docDate: (data.powerOfAttorney?.docDate || '').trim(),
            startDate: (data.powerOfAttorney?.startDate || data.powerOfAttorney?.docDate || '').trim(),
            endDate: (data.powerOfAttorney?.endDate || '').trim(),
            typeCode: (data.powerOfAttorney?.typeCode || '11004').trim()
        }
    };

    if (fillerMentions.length > 1) {
        console.log(`‚ÑπÔ∏è –ü–æ–¥–ø–∏—Å–∞–Ω—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω –∏–∑ ${fillerMentions.length} –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${bestMention.source}`);
    }
}


// =====================================================
// –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
// =====================================================

function _finalValidation(merged) {
    // –ï—Å—Ç—å –ª–∏ —Ç–æ–≤–∞—Ä—ã
    if (merged.mergedData.products.length === 0) {
        merged.validation.warnings.push({
            field: 'products',
            message: '–ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö',
            severity: 'WARNING'
        });
    }

    // –ë–ò–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è
    const consignee = merged.mergedData.counteragents.consignee;
    if (consignee?.present && consignee.entityType === 'LEGAL' && (!consignee.legal?.bin || consignee.legal.bin.length !== 12)) {
        merged.validation.warnings.push({
            field: 'consignee.legal.bin',
            message: '–ë–ò–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–π –¥–ª–∏–Ω—ã',
            severity: 'WARNING'
        });
    }

    // –ë–ò–ù –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞
    const carrier = merged.mergedData.counteragents.carrier;
    if (carrier?.present && carrier.entityType === 'LEGAL' && (!carrier.legal?.bin || carrier.legal.bin.length !== 12)) {
        merged.validation.warnings.push({
            field: 'carrier.legal.bin',
            message: '–ë–ò–ù –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–π –¥–ª–∏–Ω—ã',
            severity: 'WARNING'
        });
    }

    // –ò–ò–ù –≤–æ–¥–∏—Ç–µ–ª—è
    const driver = merged.mergedData.driver;
    if (driver.present && driver.iin && driver.iin.length !== 12) {
        merged.validation.warnings.push({
            field: 'driver.iin',
            message: `–ò–ò–ù –≤–æ–¥–∏—Ç–µ–ª—è –Ω–µ–≤–µ—Ä–Ω–æ–π –¥–ª–∏–Ω—ã: ${driver.iin.length} —Ü–∏—Ñ—Ä (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 12)`,
            severity: 'WARNING'
        });
    }

    // –ù–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
    if (!merged.mergedData.vehicles.tractorRegNumber) {
        merged.validation.warnings.push({
            field: 'vehicles.tractorRegNumber',
            message: '–ù–æ–º–µ—Ä —Ç—è–≥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ',
            severity: 'WARNING'
        });
    }

    // –ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    const consignor = merged.mergedData.counteragents.consignor;
    if (!consignor?.present) {
        merged.validation.warnings.push({
            field: 'consignor',
            message: '–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ',
            severity: 'WARNING'
        });
    }

    // –ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è
    if (!consignee?.present) {
        merged.validation.warnings.push({
            field: 'consignee',
            message: '–ü–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ',
            severity: 'WARNING'
        });
    }
}


// =====================================================
// –£—Ç–∏–ª–∏—Ç—ã
// =====================================================

/** –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ */
function _getCounteragentName(data) {
    if (data.entityType === 'LEGAL' && data.legal?.nameRu) return data.legal.nameRu;
    if (data.entityType === 'NON_RESIDENT_LEGAL' && data.nonResidentLegal?.nameRu) return data.nonResidentLegal.nameRu;
    // Fallback: –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ–±–∞
    return data.legal?.nameRu || data.nonResidentLegal?.nameRu || '';
}

/** –°—á–∏—Ç–∞–µ—Ç "–ø–æ–ª–Ω–æ—Ç—É" –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ ‚Äî –±–æ–ª—å—à–µ = –ø–æ–ª–Ω–µ–µ */
function _counteragentCompleteness(data, role, docType) {
    let score = 0;
    if (data.legal?.bin) score += 3;
    if (data.legal?.nameRu || data.nonResidentLegal?.nameRu) score += 2;
    if (data.addresses?.length > 0) score += 1;
    if (data.addresses?.[0]?.fullAddress) score += 1;

    // –ü–†–ò–û–†–ò–¢–ï–¢–´: CMR (TRANSPORT_DOC) ‚Äî —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —Ä–æ–ª–µ–π
    if (role === 'consignee' && docType === 'TRANSPORT_DOC') score += 20; // –û–≥—Ä–æ–º–Ω—ã–π –±–æ–Ω—É—Å –¥–ª—è CMR Box 2
    if (role === 'consignor' && docType === 'TRANSPORT_DOC') score += 20; // –û–≥—Ä–æ–º–Ω—ã–π –±–æ–Ω—É—Å –¥–ª—è CMR Box 1
    if (role === 'carrier' && docType === 'TRANSPORT_DOC') score += 20;   // –û–≥—Ä–æ–º–Ω—ã–π –±–æ–Ω—É—Å –¥–ª—è CMR Box 16/17
    if (role === 'declarant' && data.representativeCertificate?.docNumber) score += 30; // –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ ‚Äî 100% –ø—Ä–∏–∑–Ω–∞–∫ –±—Ä–æ–∫–µ—Ä–∞

    return score;
}

/** –†—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ */
function _roleNameRu(role) {
    const map = {
        consignor: '–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å',
        consignee: '–ü–æ–ª—É—á–∞—Ç–µ–ª—å',
        carrier: '–ü–µ—Ä–µ–≤–æ–∑—á–∏–∫',
        declarant: '–î–µ–∫–ª–∞—Ä–∞–Ω—Ç',
        filler: '–ü–æ–¥–ø–∏—Å–∞–Ω—Ç'
    };
    return map[role] || role;
}

/** –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
function _docTypeName(docType) {
    const map = {
        'INVOICE': '–ò–Ω–≤–æ–π—Å',
        'TRANSPORT_DOC': 'CMR/–¢–¢–ù',
        'REGISTRY': '–†–µ–µ—Å—Ç—Ä',
        'PACKING_LIST': '–£–ø–∞–∫–æ–≤–æ—á–Ω—ã–π –ª–∏—Å—Ç',
        'DRIVER_ID': '–£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è',
        'VEHICLE_DOC': '–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –¢–°',
        'VEHICLE_PERMIT': '–î–æ–ø—É—â–µ–Ω–∏–µ –¢–°',
        'POWER_OF_ATTORNEY': '–î–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å',
        'OTHER': '–î—Ä—É–≥–æ–π –¥–æ–∫—É–º–µ–Ω—Ç'
    };
    return map[docType] || docType;
}

/** –ü—É—Å—Ç–æ–π –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç */
function _emptyCounteragent() {
    return {
        present: false,
        entityType: 'LEGAL',
        legal: { bin: '', nameRu: '' },
        nonResidentLegal: { nameRu: '' },
        addresses: []
    };
}

/** –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –º–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤ */
/** –ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–±–æ–±—â—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ ‚Äî —ç—Ç–æ –ù–ï —Ç–æ–≤–∞—Ä—ã */
const GENERIC_PRODUCT_BLACKLIST = [
    '–¢–û–í–ê–†–´ –ü–û –û–ü–ò–°–ò',
    'CARGO AS PER',
    'GOODS AS PER',
    '–ì–†–£–ó –ü–û –ò–ù–í–û–ô–°–£',
    '–ì–†–£–ó –ü–û –û–ü–ò–°–ò',
    '–ü–û–ó–ò–¶–ò–ò –°–û–ì–õ–ê–°–ù–û',
    'ACCORDING TO INVOICE',
    'AS PER INVENTORY',
    'AS PER PACKING',
    '–ò–¢–û–ì–û',
    'TOTAL',
    '–í–°–ï–ì–û',
    'SUBTOTAL',
    'Ë¥ßÁâ©ÊåâÊ∏ÖÂçï',
    'SUMMARY',
];

function _isGenericProduct(name) {
    const upper = String(name || '').toUpperCase().trim();
    if (!upper || upper.length < 3) return true;
    return GENERIC_PRODUCT_BLACKLIST.some(pattern => upper.includes(pattern));
}

function _normalizeProducts(products) {
    return products
        .filter(p => !_isGenericProduct(p.commercialName))
        .map(p => ({
            tnvedCode: String(p.tnvedCode || '').replace(/\D/g, '').substring(0, 6),
            commercialName: String(p.commercialName || ''),
            grossWeight: parseFloat(p.grossWeight) || 0,
            quantity: parseInt(p.quantity) || 0,
            cost: parseFloat(p.cost) || 0,
            currencyCode: String(p.currencyCode || 'USD').toUpperCase()
        }));
}

/** –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (–û–¢–ö–õ–Æ–ß–ï–ù–ê –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤) */
function _deduplicateProducts(products) {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏–ª –Ω–µ "—Å–∫–ª–µ–∏–≤–∞—Ç—å" —Ç–æ–≤–∞—Ä—ã. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å.
    return products;
}

/** –°—á–∏—Ç–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å—Ö–æ–∂–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫ (0..1) –ø–æ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω—É */
function _calculateSimilarity(s1, s2) {
    if (!s1 || !s2) return 0;
    const longer = s1.length > s2.length ? s1 : s2;
    const shorter = s1.length > s2.length ? s2 : s1;
    const longerLength = longer.length;
    if (longerLength === 0) return 1.0;

    const editDistance = _levenshteinDistance(longer, shorter);
    return (longerLength - editDistance) / longerLength;
}

function _levenshteinDistance(s1, s2) {
    s1 = s1.toLowerCase();
    s2 = s2.toLowerCase();
    const costs = [];
    for (let i = 0; i <= s1.length; i++) {
        let lastValue = i;
        for (let j = 0; j <= s2.length; j++) {
            if (i === 0) costs[j] = j;
            else {
                if (j > 0) {
                    let newValue = costs[j - 1];
                    if (s1.charAt(i - 1) !== s2.charAt(j - 1))
                        newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                    costs[j - 1] = lastValue;
                    lastValue = newValue;
                }
            }
        }
        if (i > 0) costs[s2.length] = lastValue;
    }
    return costs[s2.length];
}

/** –ü—É—Å—Ç–æ–π –ø–æ–¥–ø–∏—Å–∞–Ω—Ç */
function _emptyFiller() {
    return {
        present: false,
        role: 'FILLER_DECLARANT',
        iin: '',
        firstName: '',
        lastName: '',
        patronymic: '',
        powerOfAttorney: {
            docNumber: '',
            docDate: '',
            startDate: '',
            endDate: '',
            typeCode: '11004'
        }
    };
}
